<!doctype html>
<html lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.84.3" /><META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
<link rel="shortcut icon" href="/favicon.png" >
<link rel="apple-touch-icon" href="/favicon.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicon.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicon.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicon.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicon.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicon.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicon.png" sizes="192x192">

<title>工具链 | 道场</title>
<meta name="description" content="Open and extensible continuous delivery solution for Kubernetes."><meta property="og:title" content="工具链" />
<meta property="og:description" content="Flux install, bootstrap, upgrade and uninstall documentation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/tool-chain/" /><meta property="og:image" content="/img/flux-social.png"/><meta property="article:section" content="docs" />



<meta itemprop="name" content="工具链">
<meta itemprop="description" content="Flux install, bootstrap, upgrade and uninstall documentation.">

<meta itemprop="wordCount" content="2042"><meta itemprop="image" content="/img/flux-social.png"/>
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/img/flux-social.png"/>

<meta name="twitter:title" content="工具链"/>
<meta name="twitter:description" content="Flux install, bootstrap, upgrade and uninstall documentation."/>




<link rel="preload" href="/scss/main.min.4a9db146ac33069ee85be0885ccf5f1ce3a4387f774ad3c60af13d7316e8cedc.css" as="style">
<link href="/scss/main.min.4a9db146ac33069ee85be0885ccf5f1ce3a4387f774ad3c60af13d7316e8cedc.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />





  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>flux-icon</title><desc>Created with Sketch.</desc><g id="flux-icon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Group" transform="translate(11.000000, 2.000000)"><path d="M.803134615 15.7791346c-1.049423077-.682500000000001-1.049423077-2.2188461.0-2.9007692L20.1819808.279519231c.573461499999997-.3726923079 1.3125-.3726923079 1.8859615.0L41.4473654 12.8783654c1.0494231.681923100000001 1.0494231 2.2182692.0 2.9007692L22.0679423 28.3779808C21.4944808 28.7506731 20.7554423 28.7506731 20.1819808 28.3779808L.803134615 15.7791346z" id="Fill-1" fill="#326ce5"/><path d="M24.1851346 18.0023077h1.3442308C26.3145577 18.0023077 26.8055192 17.1525 26.4126346 16.4728846L22.0084038 8.84423077C21.6160962 8.16461538 20.63475 8.16461538 20.2418654 8.84423077L15.8376346 16.4728846C15.4453269 17.1525 15.9357115 18.0023077 16.7209038 18.0023077h1.3448077c.563077.0 1.0194231.456923100000001 1.0194231 1.02v8.7075L19.9874423 28.3165385C20.6791731 28.7665385 21.5710962 28.7665385 22.2628269 28.3165385L23.1651346 27.7298077v-8.7075c0-.563076899999999.456346200000002-1.02 1.02-1.02" id="Fill-3" fill="#c1d2f7"/><path d="M27.8390769 34.8375577l-4.6742307-3.0386539v1.44C24.6902308 33.8919808 26.2588846 34.4008269 27.8390769 34.8375577" id="Fill-5" fill="#326ce5"/><path d="M23.1650769 35.8280192v2.0215385C24.7095 38.3209038 26.2723846 38.7080192 27.8191154 39.0893654c5.0515384 1.2455769 9.8226923 2.4213461 13.6592308 6.2584615C41.6733462 45.54225 41.8562308 45.7407115 42.0373846 45.93975 42.4308462 45.1880192 42.2335385 44.1957115 41.4466154 43.6845577l-7.5905769-4.9355769c-1.8426923-.608077000000002-3.72-1.073077-5.5753847-1.53C26.5308462 36.7874423 24.8196923 36.3570577 23.1650769 35.8280192" id="Fill-7" fill="#326ce5"/><path d="M19.08525 34.1699423C18.4304423 33.8318654 17.7854423 33.4689808 17.1629423 33.0489808l-1.7359615 1.1284615c1.1705769.8607692 2.3965384 1.5588462 3.6582692 2.1438462V34.1699423z" id="Fill-9" fill="#326ce5"/><path d="M24.8941731 40.6051154C24.3137885 40.4620385 23.7374423 40.3195385 23.1651346 40.1735769V42.1605C23.5885962 42.2666538 24.0114808 42.3722308 24.4326346 42.4760769c5.0515385 1.245 9.8226923 2.4207693 13.6598077 6.2578846C38.0987885 48.7408846 38.1045577 48.7472308 38.1114808 48.7541538L39.75225 47.6868462C39.6524423 47.5824231 39.5584038 47.4751154 39.4545577 47.3718462c-4.2161539-4.2167308-9.4753846-5.513077-14.5603846-6.7667308" id="Fill-11" fill="#326ce5"/><path d="M19.08525 38.9907115C16.8900577 38.2389808 14.8096731 37.2714808 12.9115962 35.8124423l-1.6996154 1.1053846c2.4167307 1.9932693 5.1075 3.2025 7.8732692 4.0990385V38.9907115z" id="Fill-13" fill="#326ce5"/><path d="M19.08525 43.3809808C15.3069808 42.3909808 11.7537115 41.18175 8.71794231 38.5388654L7.04717308 39.6252115c3.56538462 3.285 7.80692312 4.658077 12.03807692 5.745577V43.3809808z" id="Fill-15" fill="#326ce5"/><path d="M23.1650769 46.3935c3.9525 1.02057689999999 7.6690385 2.2407692 10.8173077 5.0446154l1.6615385-1.08c-3.6784616-3.4580769-8.0925-4.8386539-12.4788462-5.9532692V46.3935z" id="Fill-17" fill="#326ce5"/><path d="M4.57875 41.2299231 2.92990385 42.3018462C2.98759615 42.3612692 3.04009615 42.423 3.09951923 42.4818462 7.31625 46.6985769 12.5743269 47.9949231 17.6599038 49.2485769c4.4042308 1.0851923 8.5944231 2.1201923 12.1390385 4.9096154L31.4893269 53.0591538C27.4958654 49.6968462 22.7385577 48.5158846 18.1214423 47.3781923 13.1206731 46.1453077 8.39567308 44.9758846 4.57875 41.2299231" id="Fill-19" fill="#326ce5"/><path d="M1.07555769 44.5060962C.883442308 44.3139808.702865385 44.1184038.524019231 43.9216731-.227711538 44.6745577-.139442308 45.9726346.80325 46.5853269l5.70634615 3.7101923c2.52576923 1.0453846 5.16692305 1.6990385 7.76423075 2.3394231 4.0546154.999230799999999 7.9280769 1.9575 11.2840385 4.2807692l1.7255769-1.1226923C23.4676731 52.9245577 19.0403654 51.8255192 14.7347885 50.7639808c-5.05096158-1.245-9.82211542-2.4207693-13.65923081-6.2578846" id="Fill-21" fill="#326ce5"/><path d="M19.6441154 58.8342692C20.0243077 59.0188846 20.3998846 59.2133077 20.7691154 59.4221538 21.2093077 59.5150385 21.6771923 59.4383077 22.0683462 59.1838846L23.0260385 58.5613846C19.9493077 56.5035 16.5287308 55.461 13.1196923 54.5927308l6.5244231 4.2415384z" id="Fill-23" fill="#326ce5"/></g></g></svg></span><span class="text-uppercase font-weight-bold">道场</span>
	</a>
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs" ><span>修习</span></a>
				
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/blog/" ><span>动态</span></a>
				
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/devopschina/sig/" target="_blank" ><i class='fab fa-github'></i> <span>Github</span></a>
				
			</li>
			
			
			
			<li class="nav-item nav-search-item">
<input type="search" class="form-control td-search-input" placeholder="&#xf002; " aria-label="" autocomplete="off">

</li>
		</ul>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




  


<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  
  <nav class="collapse td-sidebar-nav foldable-nav" id="td-section-nav">
    
    
    
    
    
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docs-li">
    
      <a href="/docs/" title="入门指南" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-docs"><span class="">道场</span></a>
    
    
      
      <ul class="ul-1">
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsconcepts-li">
    
      <input type="checkbox" id="m-docsconcepts-check"/>
      <label for="m-docsconcepts-check"><a href="/docs/concepts/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsconcepts"><span class="">核心概念</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsget-started-li">
    
      <input type="checkbox" id="m-docsget-started-check"/>
      <label for="m-docsget-started-check"><a href="/docs/get-started/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsget-started"><span class="">转型方法</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-docstool-chain-li">
    
      <input type="checkbox" id="m-docstool-chain-check" checked/>
      <label for="m-docstool-chain-check"><a href="/docs/tool-chain/" class="align-left pl-0  active td-sidebar-link td-sidebar-link__page" id="m-docstool-chain"><span class="td-sidebar-nav-active-item">工具链</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsiac-li">
    
      <input type="checkbox" id="m-docsiac-check"/>
      <label for="m-docsiac-check"><a href="/docs/iac/" title="基础设施即代码" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsiac"><span class="">IaC</span></a></label>
    
    
      
      <ul class="ul-2 foldable">
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsiacrepository-structure-li">
    
      <input type="checkbox" id="m-docsiacrepository-structure-check"/>
      <label for="m-docsiacrepository-structure-check"><a href="/docs/iac/repository-structure/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsiacrepository-structure"><span class="">Ways of structuring your repositories</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsiachelmreleases-li">
    
      <input type="checkbox" id="m-docsiachelmreleases-check"/>
      <label for="m-docsiachelmreleases-check"><a href="/docs/iac/helmreleases/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsiachelmreleases"><span class="">Manage Helm Releases</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsiacnotifications-li">
    
      <input type="checkbox" id="m-docsiacnotifications-check"/>
      <label for="m-docsiacnotifications-check"><a href="/docs/iac/notifications/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsiacnotifications"><span class="">Setup Notifications</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsiacwebhook-receivers-li">
    
      <input type="checkbox" id="m-docsiacwebhook-receivers-check"/>
      <label for="m-docsiacwebhook-receivers-check"><a href="/docs/iac/webhook-receivers/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsiacwebhook-receivers"><span class="">Setup Webhook Receivers</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsiacmonitoring-li">
    
      <input type="checkbox" id="m-docsiacmonitoring-check"/>
      <label for="m-docsiacmonitoring-check"><a href="/docs/iac/monitoring/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsiacmonitoring"><span class="">Monitoring with Prometheus</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsiacsealed-secrets-li">
    
      <input type="checkbox" id="m-docsiacsealed-secrets-check"/>
      <label for="m-docsiacsealed-secrets-check"><a href="/docs/iac/sealed-secrets/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsiacsealed-secrets"><span class="">Sealed Secrets</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsiacmozilla-sops-li">
    
      <input type="checkbox" id="m-docsiacmozilla-sops-check"/>
      <label for="m-docsiacmozilla-sops-check"><a href="/docs/iac/mozilla-sops/" title="Manage Kubernetes secrets with Mozilla SOPS" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsiacmozilla-sops"><span class="">Mozilla SOPS</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsiacimage-update-li">
    
      <input type="checkbox" id="m-docsiacimage-update-check"/>
      <label for="m-docsiacimage-update-check"><a href="/docs/iac/image-update/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsiacimage-update"><span class="">Automate image updates to Git</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsiacsortable-image-tags-li">
    
      <input type="checkbox" id="m-docsiacsortable-image-tags-check"/>
      <label for="m-docsiacsortable-image-tags-check"><a href="/docs/iac/sortable-image-tags/" title="How to make sortable image tags to use with automation" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsiacsortable-image-tags"><span class="">Sortable image tags to use with automation</span></a></label>
    
    
  </li>

          
        
      </ul>
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsagile-li">
    
      <input type="checkbox" id="m-docsagile-check"/>
      <label for="m-docsagile-check"><a href="/docs/agile/" title="敏捷道场" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsagile"><span class="">Agile</span></a></label>
    
    
      
      <ul class="ul-2 foldable">
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsagilesource-li">
    
      <input type="checkbox" id="m-docsagilesource-check"/>
      <label for="m-docsagilesource-check"><a href="/docs/agile/source/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsagilesource"><span class="">Source Controller</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsagilekustomize-li">
    
      <input type="checkbox" id="m-docsagilekustomize-check"/>
      <label for="m-docsagilekustomize-check"><a href="/docs/agile/kustomize/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsagilekustomize"><span class="">Kustomize Controller</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsagilehelm-li">
    
      <input type="checkbox" id="m-docsagilehelm-check"/>
      <label for="m-docsagilehelm-check"><a href="/docs/agile/helm/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsagilehelm"><span class="">Helm Controller</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsagilenotification-li">
    
      <input type="checkbox" id="m-docsagilenotification-check"/>
      <label for="m-docsagilenotification-check"><a href="/docs/agile/notification/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsagilenotification"><span class="">Notification Controller</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsagileimage-li">
    
      <input type="checkbox" id="m-docsagileimage-check"/>
      <label for="m-docsagileimage-check"><a href="/docs/agile/image/" title="Image reflector and automation controllers" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsagileimage"><span class="">Image Automation Controllers</span></a></label>
    
    
  </li>

          
        
      </ul>
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsgitops-toolkit-li">
    
      <input type="checkbox" id="m-docsgitops-toolkit-check"/>
      <label for="m-docsgitops-toolkit-check"><a href="/docs/gitops-toolkit/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsgitops-toolkit"><span class="">Toolkit Dev Guides</span></a></label>
    
    
      
      <ul class="ul-2 foldable">
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgitops-toolkitpackages-li">
    
      <input type="checkbox" id="m-docsgitops-toolkitpackages-check"/>
      <label for="m-docsgitops-toolkitpackages-check"><a href="/docs/gitops-toolkit/packages/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsgitops-toolkitpackages"><span class="">Using the GitOps Toolkit APIs with Go</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgitops-toolkitsource-watcher-li">
    
      <input type="checkbox" id="m-docsgitops-toolkitsource-watcher-check"/>
      <label for="m-docsgitops-toolkitsource-watcher-check"><a href="/docs/gitops-toolkit/source-watcher/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsgitops-toolkitsource-watcher"><span class="">Watching for source changes</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgitops-toolkitdebugging-li">
    
      <input type="checkbox" id="m-docsgitops-toolkitdebugging-check"/>
      <label for="m-docsgitops-toolkitdebugging-check"><a href="/docs/gitops-toolkit/debugging/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsgitops-toolkitdebugging"><span class="">Advanced debugging</span></a></label>
    
    
  </li>

          
        
      </ul>
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsgitops-li">
    
      <input type="checkbox" id="m-docsgitops-check"/>
      <label for="m-docsgitops-check"><a href="/docs/gitops/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsgitops"><span class="">GitOps</span></a></label>
    
    
      
      <ul class="ul-2 foldable">
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgitopspackages-li">
    
      <input type="checkbox" id="m-docsgitopspackages-check"/>
      <label for="m-docsgitopspackages-check"><a href="/docs/gitops/packages/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsgitopspackages"><span class="">Using the GitOps Toolkit APIs with Go</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgitopssource-watcher-li">
    
      <input type="checkbox" id="m-docsgitopssource-watcher-check"/>
      <label for="m-docsgitopssource-watcher-check"><a href="/docs/gitops/source-watcher/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsgitopssource-watcher"><span class="">Watching for source changes</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgitopsdebugging-li">
    
      <input type="checkbox" id="m-docsgitopsdebugging-check"/>
      <label for="m-docsgitopsdebugging-check"><a href="/docs/gitops/debugging/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsgitopsdebugging"><span class="">Advanced debugging</span></a></label>
    
    
  </li>

          
        
      </ul>
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsroadmap-li">
    
      <input type="checkbox" id="m-docsroadmap-check"/>
      <label for="m-docsroadmap-check"><a href="/docs/roadmap/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsroadmap"><span class="">Roadmap</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsfaq-li">
    
      <input type="checkbox" id="m-docsfaq-check"/>
      <label for="m-docsfaq-check"><a href="/docs/faq/" title="Frequently asked questions" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsfaq"><span class="">FAQ</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docscontributing-li">
    
      <input type="checkbox" id="m-docscontributing-check"/>
      <label for="m-docscontributing-check"><a href="/docs/contributing/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docscontributing"><span class="">Contributing</span></a></label>
    
    
      
      <ul class="ul-2 foldable">
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docscontributingdocs-li">
    
      <input type="checkbox" id="m-docscontributingdocs-check"/>
      <label for="m-docscontributingdocs-check"><a href="/docs/contributing/docs/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docscontributingdocs"><span class="">Documentation</span></a></label>
    
    
      
      <ul class="ul-3 foldable">
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscontributingdocssome-background-li">
    
      <input type="checkbox" id="m-docscontributingdocssome-background-check"/>
      <label for="m-docscontributingdocssome-background-check"><a href="/docs/contributing/docs/some-background/" title="Where to find the docs and how to contribute" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docscontributingdocssome-background"><span class="">Some background</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscontributingdocsproposing-changes-li">
    
      <input type="checkbox" id="m-docscontributingdocsproposing-changes-check"/>
      <label for="m-docscontributingdocsproposing-changes-check"><a href="/docs/contributing/docs/proposing-changes/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docscontributingdocsproposing-changes"><span class="">Proposing changes</span></a></label>
    
    
  </li>

          
        
          
            
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscontributingdocswriting-docs-li">
    
      <input type="checkbox" id="m-docscontributingdocswriting-docs-check"/>
      <label for="m-docscontributingdocswriting-docs-check"><a href="/docs/contributing/docs/writing-docs/" title="Docs from the ground up" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docscontributingdocswriting-docs"><span class="">Writing docs</span></a></label>
    
    
  </li>

          
        
      </ul>
    
  </li>

          
        
      </ul>
    
  </li>

          
        
      </ul>
    
  </li>

    </ul>
  </nav>
</div>




          </aside>
          
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
  
  
  
  
  
  
  
  <div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
  
    
    
      
    
    
    
    
    
    
    

    
    <a href="https://github.com/fluxcd/website/edit/main/content/zh-cn/docs/tool-chain.md" target="_blank"><i class="fa fa-edit fa-fw"></i> </a>
    <a href="https://github.com/fluxcd/website/new/main/content/zh-cn/docs/tool-chain.md?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" target="_blank"><i class="fa fa-edit fa-fw"></i> </a>
    
    <a href="https://github.com/fluxcd/website/issues/new?title=%e5%b7%a5%e5%85%b7%e9%93%be" target="_blank"><i class="fab fa-github fa-fw"></i> </a>
    
      
      <a href="https://github.com/fluxcd/flux2/issues/new" target="_blank"><i class="fas fa-tasks fa-fw"></i> </a>
    

  
  
  </div>


            


<div class="td-toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#install-the-flux-cli">Install the Flux CLI</a></li>
    <li><a href="#bootstrap">Bootstrap</a>
      <ul>
        <li><a href="#generic-git-server">Generic Git Server</a></li>
        <li><a href="#github-and-github-enterprise">GitHub and GitHub Enterprise</a></li>
        <li><a href="#gitlab-and-gitlab-enterprise">GitLab and GitLab Enterprise</a></li>
        <li><a href="#air-gapped-environments">Air-gapped Environments</a></li>
      </ul>
    </li>
    <li><a href="#bootstrap-with-terraform">Bootstrap with Terraform</a></li>
    <li><a href="#customize-flux-manifests">Customize Flux manifests</a>
      <ul>
        <li><a href="#pod-security-policy">Pod Security Policy</a></li>
      </ul>
    </li>
    <li><a href="#dev-install">Dev install</a></li>
    <li><a href="#upgrade">Upgrade</a>
      <ul>
        <li><a href="#bootstrap-upgrade">Bootstrap upgrade</a></li>
        <li><a href="#terraform-upgrade">Terraform upgrade</a></li>
        <li><a href="#in-cluster-upgrade">In-cluster upgrade</a></li>
      </ul>
    </li>
    <li><a href="#uninstall">Uninstall</a></li>
  </ul>
</nav></div>



            

	
		



  
  

	
		



  
  

	

          </aside>
          
          
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
          
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		







<li class="breadcrumb-item" >
	<a href="/docs/">道场</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/docs/tool-chain/">工具链</a>
</li>

	</ol>
</nav	>

            
            
<div class="td-content">
	<h1>工具链</h1>
	<div class="lead">Flux install, bootstrap, upgrade and uninstall documentation.</div>
	<header class="article-meta">
		
		
			
				


			
				


			
		
		
	</header>    
	<p>This guide walks you through setting up Flux to
manage one or more Kubernetes clusters.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>You will need a Kubernetes cluster version <strong>1.16</strong> or newer
and kubectl version <strong>1.18</strong> or newer.</p>
<h2 id="install-the-flux-cli">Install the Flux CLI</h2>
<p>With 
<a href="https://brew.sh" target="_blank">Homebrew</a> for macOS and Linux:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">brew install fluxcd/tap/flux
</code></pre></div><p>With 
<a href="https://gofi.sh" target="_blank">GoFish</a> for Windows, macOS and Linux:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gofish install flux
</code></pre></div><p>With 
<a href="https://github.com/Jguer/yay" target="_blank">yay</a> (or another 
<a href="https://wiki.archlinux.org/title/AUR_helpers" target="_blank">AUR helper</a>) for Arch Linux:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">yay -S flux-bin
</code></pre></div><p>With Bash for macOS and Linux:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -s https://fluxcd.io/install.sh | sudo bash

<span style="color:#60a0b0;font-style:italic"># enable completions in ~/.bash_profile</span>
. &lt;<span style="color:#666">(</span>flux completion bash<span style="color:#666">)</span>
</code></pre></div><p>Command-line completion for <code>zsh</code>, <code>fish</code>, and <code>powershell</code>
are also supported with their own sub-commands.</p>
<p>Binaries for macOS AMD64/ARM64, Linux AMD64/ARM and Windows are available for
download on the 
<a href="https://github.com/fluxcd/flux2/releases" target="_blank">release page</a>.</p>
<p>A container image with <code>kubectl</code> and <code>flux</code> is available on DockerHub and GitHub:</p>
<ul>
<li><code>docker.io/fluxcd/flux-cli:&lt;version&gt;</code></li>
<li><code>ghcr.io/fluxcd/flux-cli:&lt;version&gt;</code></li>
</ul>
<p>Verify that your cluster satisfies the prerequisites with:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux check --pre
</code></pre></div><h2 id="bootstrap">Bootstrap</h2>
<p>Using the <code>flux bootstrap</code> command you can install Flux on a
Kubernetes cluster and configure it to manage itself from a Git
repository.</p>
<p>If the Flux components are present on the cluster, the bootstrap
command will perform an upgrade if needed. The bootstrap is
idempotent, it&rsquo;s safe to run the command as many times as you want.</p>
<p>The Flux component images are published to DockerHub and GitHub Container Registry
as 
<a href="https://docs.docker.com/docker-for-mac/multi-arch/" target="_blank">multi-arch container images</a>
with support for Linux <code>amd64</code>, <code>arm64</code> and <code>armv7</code> (e.g. 32bit Raspberry Pi)
architectures.</p>
<p>If your Git provider is <strong>GitHub</strong>, <strong>GitLab</strong> or <strong>Azure DevOps</strong> please follow the specific bootstrap procedure:</p>
<ul>
<li>
<a href="#github-and-github-enterprise">GitHub.com and GitHub Enterprise</a></li>
<li>
<a href="#gitlab-and-gitlab-enterprise">GitLab.com and GitLab Enterprise</a></li>
<li>
<a href="../use-cases/azure.md#flux-installation-for-azure-devops">Azure DevOps</a></li>
</ul>
<h3 id="generic-git-server">Generic Git Server</h3>
<p>The <code>bootstrap git</code> command takes an existing Git repository, clones it and
commits the Flux components manifests to the specified branch. Then it
configures the target cluster to synchronize with that repository.</p>
<p>Run bootstrap for a Git repository and authenticate with your SSH agent:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap git <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --url<span style="color:#666">=</span>ssh://git@&lt;host&gt;/&lt;org&gt;/&lt;repository&gt; <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --branch<span style="color:#666">=</span>&lt;my-branch&gt; <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster
</code></pre></div><p>The above command will generate a SSH key (defaults to RSA 2048 but can be changed with <code>--ssh-key-algorithm</code>),
and it will prompt you to add the SSH public key as a deploy key to your repository.</p>
<p>If you want to use your own SSH key, you can provide a private key using
<code>--private-key-file=&lt;path/to/private.key&gt;</code> (you can supply the passphrase with <code>--password=&lt;key-passphrase&gt;</code>).
This option can also be used if no SSH agent is available on your machine.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Bootstrap options</h4>

    There are many options available when bootstrapping Flux, such as installing a subset of Flux components,
setting the Kubernetes context, changing the Git author name and email, enabling Git submodules, and more.
To list all the available options run <code>flux bootstrap git --help</code>.

</div>

<p>If your Git server doesn&rsquo;t support SSH, you can run bootstrap for Git over HTTPS:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap git <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --url<span style="color:#666">=</span>https://&lt;host&gt;/&lt;org&gt;/&lt;repository&gt; <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --username<span style="color:#666">=</span>&lt;my-username&gt; <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --password<span style="color:#666">=</span>&lt;my-password&gt; <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --token-auth<span style="color:#666">=</span><span style="color:#007020">true</span> <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster
</code></pre></div><p>If your Git server uses a self-signed TLS certificate, you can specify the CA file with
<code>--ca-file=&lt;path/to/ca.crt&gt;</code>.</p>
<p>With <code>--path</code> you can configure the directory which will be used to reconcile the target cluster.
To control multiple clusters from the same Git repository, you have to set a unique path per
cluster e.g. <code>clusters/staging</code> and <code>clusters/production</code>:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./clusters/
├── staging <span style="color:#60a0b0;font-style:italic"># &lt;- path=clusters/staging</span>
│   └── flux-system <span style="color:#60a0b0;font-style:italic"># &lt;- namespace dir generated by bootstrap</span>
│       ├── gotk-components.yaml
│       ├── gotk-sync.yaml
│       └── kustomization.yaml
└── production <span style="color:#60a0b0;font-style:italic"># &lt;- path=clusters/production</span>
    └── flux-system
</code></pre></div><p>After running bootstrap you can place Kubernetes YAMLs inside a dir under path
e.g. <code>clusters/staging/my-app</code>, and Flux will reconcile them on your cluster.</p>
<p>For examples on how you can structure your Git repository see:</p>
<ul>
<li>
<a href="https://github.com/fluxcd/flux2-kustomize-helm-example" target="_blank">flux2-kustomize-helm-example</a></li>
<li>
<a href="https://github.com/fluxcd/flux2-multi-tenancy" target="_blank">flux2-multi-tenancy</a></li>
</ul>
<h3 id="github-and-github-enterprise">GitHub and GitHub Enterprise</h3>
<p>The <code>bootstrap github</code> command creates a GitHub repository if one doesn&rsquo;t exist and
commits the Flux components manifests to specified branch. Then it
configures the target cluster to synchronize with that repository by
setting up a SSH deploy key or by using token-based authentication.</p>
<p>Generate a 
<a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line" target="_blank">personal access token</a>
that can create repositories by checking all permissions under <code>repo</code>.</p>
<p>Export your GitHub personal access token as an environment variable:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#007020">export</span> <span style="color:#bb60d5">GITHUB_TOKEN</span><span style="color:#666">=</span>&lt;your-token&gt;
</code></pre></div><p>Run the bootstrap for a repository on your personal GitHub account:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap github <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --owner<span style="color:#666">=</span>my-github-username <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --repository<span style="color:#666">=</span>my-repository <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --personal
</code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Deploy key</h4>

    The bootstrap command creates an SSH key which it stores as a secret in the
Kubernetes cluster. The key is also used to create a deploy key in the GitHub
repository. The new deploy key will be linked to the personal access token used
to authenticate. <strong>Removing the personal access token will also remove the deploy key.</strong>

</div>

<p>Run the bootstrap for a repository owned by a GitHub organization:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap github <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --owner<span style="color:#666">=</span>my-github-organization <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --repository<span style="color:#666">=</span>my-repository <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --team<span style="color:#666">=</span>team1-slug <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --team<span style="color:#666">=</span>team2-slug <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster
</code></pre></div><p>When you specify a list of teams, those teams will be granted maintainer access to the repository.</p>
<p>To run the bootstrap for a repository hosted on GitHub Enterprise, you have to specify your GitHub hostname:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap github <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --hostname<span style="color:#666">=</span>my-github-enterprise.com <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --ssh-hostname<span style="color:#666">=</span>my-github-enterprise.com <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --owner<span style="color:#666">=</span>my-github-organization <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --repository<span style="color:#666">=</span>my-repository <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --branch<span style="color:#666">=</span>main <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster
</code></pre></div><p>If your GitHub Enterprise has SSH access disabled, you can use HTTPS and token authentication with:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap github <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --token-auth <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --hostname<span style="color:#666">=</span>my-github-enterprise.com <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --owner<span style="color:#666">=</span>my-github-organization <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --repository<span style="color:#666">=</span>my-repository <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --branch<span style="color:#666">=</span>main <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster
</code></pre></div><h3 id="gitlab-and-gitlab-enterprise">GitLab and GitLab Enterprise</h3>
<p>The <code>bootstrap gitlab</code> command creates a GitLab repository if one doesn&rsquo;t exist and
commits the Flux components manifests to specified branch. Then it
configures the target cluster to synchronize with that repository by
setting up a SSH deploy key or by using token-based authentication.</p>
<p>Generate a 
<a href="https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html" target="_blank">personal access token</a>
that grants complete read/write access to the GitLab API.</p>
<p>Export your GitLab personal access token as an environment variable:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#007020">export</span> <span style="color:#bb60d5">GITLAB_TOKEN</span><span style="color:#666">=</span>&lt;your-token&gt;
</code></pre></div><p>Run the bootstrap for a repository on your personal GitLab account:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap gitlab <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --owner<span style="color:#666">=</span>my-gitlab-username <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --repository<span style="color:#666">=</span>my-repository <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --branch<span style="color:#666">=</span>master <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --token-auth <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --personal
</code></pre></div><p>To run the bootstrap for a repository using deploy keys for authentication, you have to specify the SSH hostname:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap gitlab <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --ssh-hostname<span style="color:#666">=</span>gitlab.com <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --owner<span style="color:#666">=</span>my-gitlab-username <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --repository<span style="color:#666">=</span>my-repository <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --branch<span style="color:#666">=</span>master <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster
</code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Authentication</h4>

    When providing the <code>--ssh-hostname</code>, a read-only (SSH) deploy key will be added
to your repository, otherwise your GitLab personal token will be used to
authenticate against the HTTPS endpoint instead.

</div>

<p>Run the bootstrap for a repository owned by a GitLab (sub)group:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap gitlab <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --owner<span style="color:#666">=</span>my-gitlab-group/my-gitlab-subgroup <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --repository<span style="color:#666">=</span>my-repository <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --branch<span style="color:#666">=</span>master <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster
</code></pre></div><p>To run the bootstrap for a repository hosted on GitLab on-prem or enterprise, you have to specify your GitLab hostname:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap gitlab <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --hostname<span style="color:#666">=</span>my-gitlab.com <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --token-auth <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --owner<span style="color:#666">=</span>my-gitlab-group <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --repository<span style="color:#666">=</span>my-repository <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --branch<span style="color:#666">=</span>master <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster
</code></pre></div><h3 id="air-gapped-environments">Air-gapped Environments</h3>
<p>To bootstrap Flux on air-gapped environments without access to github.com and ghcr.io, first you&rsquo;ll need
to download the <code>flux</code> binary, and the container images from a computer with access to internet.</p>
<p>List all container images:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ flux install --export | grep ghcr.io

image: ghcr.io/fluxcd/helm-controller:v0.8.0
image: ghcr.io/fluxcd/kustomize-controller:v0.9.0
image: ghcr.io/fluxcd/notification-controller:v0.9.0
image: ghcr.io/fluxcd/source-controller:v0.9.0
</code></pre></div><p>Pull the images locally and push them to your container registry:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">docker pull ghcr.io/fluxcd/source-controller:v0.9.0
docker tag ghcr.io/fluxcd/source-controller:v0.9.0 registry.internal/fluxcd/source-controller:v0.9.0
docker push registry.internal/fluxcd/source-controller:v0.9.0
</code></pre></div><p>Copy <code>flux</code> binary to a computer with access to your air-gapped cluster,
and create the pull secret in the <code>flux-system</code> namespace:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl create ns flux-system

kubectl -n flux-system create secret generic regcred <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>    --from-file<span style="color:#666">=</span>.dockerconfigjson<span style="color:#666">=</span>/.docker/config.json <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>    --type<span style="color:#666">=</span>kubernetes.io/dockerconfigjson
</code></pre></div><p>Finally, bootstrap Flux using the images from your private registry:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap &lt;GIT-PROVIDER&gt; <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --registry<span style="color:#666">=</span>registry.internal/fluxcd <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --image-pull-secret<span style="color:#666">=</span>regcred <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --hostname<span style="color:#666">=</span>my-git-server.internal
</code></pre></div><p>Note that when running <code>flux bootstrap</code> without specifying a <code>--version</code>,
the CLI will use the manifests embedded in its binary instead of downloading
them from GitHub. You can determine which version you&rsquo;ll be installing,
with <code>flux --version</code>.</p>
<h2 id="bootstrap-with-terraform">Bootstrap with Terraform</h2>
<p>The bootstrap procedure can be implemented with Terraform using the Flux provider published on

<a href="https://registry.terraform.io/providers/fluxcd/flux" target="_blank">registry.terraform.io</a>.</p>
<p>The provider consists of two data sources (<code>flux_install</code> and <code>flux_sync</code>) for generating the
Kubernetes manifests that can be used to install or upgrade Flux:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-hcl" data-lang="hcl"><span style="color:#007020;font-weight:bold">data</span> <span style="color:#4070a0">&#34;flux_install&#34; &#34;main&#34;</span> {
  target_path    <span style="color:#666">=</span> <span style="color:#4070a0">&#34;clusters/my-cluster&#34;</span>
  network_policy <span style="color:#666">=</span> <span style="color:#902000">false</span>
  version        <span style="color:#666">=</span> <span style="color:#4070a0">&#34;latest&#34;</span>
}

<span style="color:#007020;font-weight:bold">data</span> <span style="color:#4070a0">&#34;flux_sync&#34; &#34;main&#34;</span> {
  target_path <span style="color:#666">=</span> <span style="color:#4070a0">&#34;clusters/my-cluster&#34;</span>
  url         <span style="color:#666">=</span> <span style="color:#4070a0">&#34;https://github.com/${var.github_owner}/${var.repository_name}&#34;</span>
  branch      <span style="color:#666">=</span> <span style="color:#4070a0">&#34;main&#34;</span>
}
</code></pre></div><p>For more details on how to use the Terraform provider
please see 
<a href="https://github.com/fluxcd/terraform-provider-flux" target="_blank">fluxcd/terraform-provider-flux</a>.</p>
<h2 id="customize-flux-manifests">Customize Flux manifests</h2>
<p>You can customize the Flux components before or after running bootstrap.</p>
<p>Assuming you want to customise the Flux controllers before they get deployed on the cluster,
first you&rsquo;ll need to create a Git repository and clone it locally.</p>
<p>Create the file structure required by bootstrap with:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir -p clusters/my-cluster/flux-system
touch clusters/my-cluster/flux-system/gotk-components.yaml <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>    clusters/my-cluster/flux-system/gotk-patches.yaml <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>    clusters/my-cluster/flux-system/gotk-sync.yaml <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>    clusters/my-cluster/flux-system/kustomization.yaml
</code></pre></div><p>Assuming you want to add custom annotations and labels to the Flux controllers,
edit <code>clusters/my-cluster/gotk-patches.yaml</code> and set the metadata for source-controller and kustomize-controller pods:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">name</span>:<span style="color:#bbb"> </span>source-controller<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">namespace</span>:<span style="color:#bbb"> </span>flux-system<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">template</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#062873;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#062873;font-weight:bold">annotations</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#062873;font-weight:bold">custom</span>:<span style="color:#bbb"> </span>annotation<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#062873;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#062873;font-weight:bold">custom</span>:<span style="color:#bbb"> </span>label<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#0e84b5;font-weight:bold">---</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">name</span>:<span style="color:#bbb"> </span>kustomize-controller<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">namespace</span>:<span style="color:#bbb"> </span>flux-system<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">template</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#062873;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#062873;font-weight:bold">annotations</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#062873;font-weight:bold">custom</span>:<span style="color:#bbb"> </span>annotation<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#062873;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#062873;font-weight:bold">custom</span>:<span style="color:#bbb"> </span>label<span style="color:#bbb">
</span></code></pre></div><p>Edit <code>clusters/my-cluster/kustomization.yaml</code> and set the resources and patches:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>kustomize.config.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Kustomization<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- gotk-components.yaml<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- gotk-sync.yaml<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">patchesStrategicMerge</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- gotk-patches.yaml<span style="color:#bbb">
</span></code></pre></div><p>Push the changes to main branch:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git add -A <span style="color:#666">&amp;&amp;</span> git commit -m <span style="color:#4070a0">&#34;add flux customisations&#34;</span> <span style="color:#666">&amp;&amp;</span> git push
</code></pre></div><p>Now run the bootstrap for <code>clusters/my-cluster</code>:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap git <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --url<span style="color:#666">=</span>ssh://git@&lt;host&gt;/&lt;org&gt;/&lt;repository&gt; <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --branch<span style="color:#666">=</span>main <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster
</code></pre></div><p>When the controllers are deployed for the first time on your cluster, they will contain all
the customisations from <code>gotk-patches.yaml</code>.</p>
<p>You can make changes to the patches after bootstrap and Flux will apply them in-cluster on its own.</p>
<h3 id="pod-security-policy">Pod Security Policy</h3>
<p>Assuming you want to make the Flux controllers conform to Pod Security Policy or equivalent webhooks,
create a file at <code>clusters/my-cluster/psp-patch.yaml</code> with the following content:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">name</span>:<span style="color:#bbb"> </span>all-flux-components<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">template</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#062873;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#062873;font-weight:bold">annotations</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#60a0b0;font-style:italic"># Required by Kubernetes node autoscaler</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#062873;font-weight:bold">cluster-autoscaler.kubernetes.io/safe-to-evict</span>:<span style="color:#bbb"> </span><span style="color:#4070a0">&#34;true&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#062873;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#062873;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#062873;font-weight:bold">runAsUser</span>:<span style="color:#bbb"> </span><span style="color:#40a070">10000</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#062873;font-weight:bold">fsGroup</span>:<span style="color:#bbb"> </span><span style="color:#40a070">1337</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#062873;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#062873;font-weight:bold">name</span>:<span style="color:#bbb"> </span>manager<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#062873;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#062873;font-weight:bold">readOnlyRootFilesystem</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#062873;font-weight:bold">allowPrivilegeEscalation</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#062873;font-weight:bold">runAsNonRoot</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#062873;font-weight:bold">capabilities</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#062873;font-weight:bold">drop</span>:<span style="color:#bbb">
</span><span style="color:#bbb">                </span>- ALL<span style="color:#bbb">
</span></code></pre></div><p>Edit <code>clusters/my-cluster/kustomization.yaml</code> and enable the patch:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>kustomize.config.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Kustomization<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb"></span>- gotk-components.yaml<span style="color:#bbb">
</span><span style="color:#bbb"></span>- gotk-sync.yaml<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">patches</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#062873;font-weight:bold">path</span>:<span style="color:#bbb"> </span>psp-patch.yaml<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#062873;font-weight:bold">target</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#062873;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span></code></pre></div><p>Push the changes to the main branch and run <code>flux bootstrap</code>.</p>
<h2 id="dev-install">Dev install</h2>
<p>For testing purposes you can install Flux without storing its manifests in a Git repository:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux install
</code></pre></div><p>Or using kubectl:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl apply -f https://github.com/fluxcd/flux2/releases/latest/download/install.yaml
</code></pre></div><p>Then you can register Git repositories and reconcile them on your cluster:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux create <span style="color:#007020">source</span> git podinfo <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --url<span style="color:#666">=</span>https://github.com/stefanprodan/podinfo <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --tag-semver<span style="color:#666">=</span><span style="color:#4070a0">&#34;&gt;=4.0.0&#34;</span> <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --interval<span style="color:#666">=</span>1m

flux create kustomization podinfo-default <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --source<span style="color:#666">=</span>podinfo <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span><span style="color:#4070a0">&#34;./kustomize&#34;</span> <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --prune<span style="color:#666">=</span><span style="color:#007020">true</span> <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --validation<span style="color:#666">=</span>client <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --interval<span style="color:#666">=</span>10m <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --health-check<span style="color:#666">=</span><span style="color:#4070a0">&#34;Deployment/podinfo.default&#34;</span> <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --health-check-timeout<span style="color:#666">=</span>2m
</code></pre></div><p>You can register Helm repositories and create Helm releases:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux create <span style="color:#007020">source</span> helm bitnami <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --interval<span style="color:#666">=</span>1h <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --url<span style="color:#666">=</span>https://charts.bitnami.com/bitnami

flux create helmrelease nginx <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --interval<span style="color:#666">=</span>1h <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --release-name<span style="color:#666">=</span>nginx-ingress-controller <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --target-namespace<span style="color:#666">=</span>kube-system <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --source<span style="color:#666">=</span>HelmRepository/bitnami <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --chart<span style="color:#666">=</span>nginx-ingress-controller <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --chart-version<span style="color:#666">=</span><span style="color:#4070a0">&#34;5.x.x&#34;</span>
</code></pre></div><h2 id="upgrade">Upgrade</h2>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Patch versions</h4>

    It is safe and advised to use the latest PATCH version when upgrading to a
new MINOR version.

</div>

<p>Update Flux CLI to the latest release with <code>brew upgrade fluxcd/tap/flux</code> or by
downloading the binary from 
<a href="https://github.com/fluxcd/flux2/releases" target="_blank">GitHub</a>.</p>
<p>Verify that you are running the latest version with:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux --version
</code></pre></div><h3 id="bootstrap-upgrade">Bootstrap upgrade</h3>
<p>If you&rsquo;ve used the 
<a href="#bootstrap">bootstrap</a> procedure to deploy Flux,
then rerun the bootstrap command for each cluster using the same arguments as before:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux bootstrap github <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --owner<span style="color:#666">=</span>my-github-username <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --repository<span style="color:#666">=</span>my-repository <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --branch<span style="color:#666">=</span>main <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --path<span style="color:#666">=</span>clusters/my-cluster <span style="color:#4070a0;font-weight:bold">\
</span><span style="color:#4070a0;font-weight:bold"></span>  --personal
</code></pre></div><p>The above command will clone the repository, it will update the components manifest in
<code>&lt;path&gt;/flux-system/gotk-components.yaml</code> and it will push the changes to the remote branch.</p>
<p>Tell Flux to pull the manifests from Git and upgrade itself with:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux reconcile <span style="color:#007020">source</span> git flux-system
</code></pre></div><p>Verify that the controllers have been upgrade with:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux check
</code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Automated upgrades</h4>

    You can automate the components manifest update with GitHub Actions
and open a PR when there is a new Flux version available.
For more details please see 
<a href="https://github.com/fluxcd/flux2/tree/main/action" target="_blank">Flux GitHub Action docs</a>.

</div>

<h3 id="terraform-upgrade">Terraform upgrade</h3>
<p>Update the Flux provider to the 
<a href="https://github.com/fluxcd/terraform-provider-flux/releases" target="_blank">latest release</a>
and run <code>terraform apply</code>.</p>
<p>Tell Flux to upgrade itself in-cluster or wait for it to pull the latest commit from Git:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl annotate --overwrite gitrepository/flux-system reconcile.fluxcd.io/requestedAt<span style="color:#666">=</span><span style="color:#4070a0">&#34;</span><span style="color:#007020;font-weight:bold">$(</span>date +%s<span style="color:#007020;font-weight:bold">)</span><span style="color:#4070a0">&#34;</span>
</code></pre></div><h3 id="in-cluster-upgrade">In-cluster upgrade</h3>
<p>If you&rsquo;ve installed Flux directly on the cluster, then rerun the install command:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux install
</code></pre></div><p>The above command will  apply the new manifests on your cluster.
You can verify that the controllers have been upgraded to the latest version with <code>flux check</code>.</p>
<p>If you&rsquo;ve installed Flux directly on the cluster with kubectl,
then rerun the command using the latest manifests from the <code>main</code> branch:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kustomize build https://github.com/fluxcd/flux2/manifests/install?ref<span style="color:#666">=</span>main | kubectl apply -f-
</code></pre></div><h2 id="uninstall">Uninstall</h2>
<p>You can uninstall Flux with:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux uninstall --namespace<span style="color:#666">=</span>flux-system
</code></pre></div><p>The above command performs the following operations:</p>
<ul>
<li>deletes Flux components (deployments and services)</li>
<li>deletes Flux network policies</li>
<li>deletes Flux RBAC (service accounts, cluster roles and cluster role bindings)</li>
<li>removes the Kubernetes finalizers from Flux custom resources</li>
<li>deletes Flux custom resource definitions and custom resources</li>
<li>deletes the namespace where Flux was installed</li>
</ul>
<p>If you&rsquo;ve installed Flux in a namespace that you wish to preserve, you
can skip the namespace deletion with:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flux uninstall --namespace<span style="color:#666">=</span>infra --keep-namespace
</code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Reinstall</h4>

    Note that the <code>uninstall</code> command will not remove any Kubernetes objects
or Helm releases that were reconciled on the cluster by Flux.
It is safe to uninstall Flux and rerun the boostrap, any existing workloads
will not be affected.

</div>


	
	
	<div class="text-muted mt-5 pt-3 border-top">

</div>

</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/fluxcd" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="LinkedIn" aria-label="LinkedIn">
    <a class="text-white" target="_blank" rel="noopener" href="https://linkedin.com/groups/8985374" aria-label="LinkedIn">
      <i class="fab fa-linkedin"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="RSS Feed" aria-label="RSS Feed">
    <a class="text-white" target="_blank" rel="noopener" href="/blog/index.xml" aria-label="RSS Feed">
      <i class="fa fa-rss"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Support" aria-label="Support">
    <a class="text-white" target="_blank" rel="noopener" href="/support" aria-label="Support">
      <i class="fas fa-comments"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Flux project on GitHub" aria-label="Flux project on GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/fluxcd" aria-label="Flux project on GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://cloud-native.slack.com/messages/flux" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Developer mailing list" aria-label="Developer mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://lists.cncf.io/g/cncf-flux-dev" aria-label="Developer mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Flux YouTube channel" aria-label="Flux YouTube channel">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.youtube.com/channel/UCoZxt-YMhGHb20ZkvcCc5KA" aria-label="Flux YouTube channel">
      <i class="fab fa-youtube"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 The Flux authors </small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>






 











<script src="/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js" integrity="sha256-XHS4cMaVOTGnBfOQpJx&#43;TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin="anonymous"></script>



<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: '45f9f14d53600b0a2cafa46a26ee10f4',
indexName: 'fluxcd',
inputSelector: '.td-search-input',

algoliaOptions: { 'facetFilters': ["tags:current"] },

debug: false 
});
</script>



  </body>
</html>